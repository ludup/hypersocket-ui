<div id="deleteAccount">
	<div id="deleteDialog" class="modal fade">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
                <div class="modal-header lb-modal-header-text-reverse">
                    <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" localize="deleteAccount.title"></h4>
                </div>
				<div class="modal-body">
					<div id="deleteAccountInfo" class="alert alert-warning" localize="deleteAccount.info"></div>
					<div id="removeRemoteContainer" class="propertyItem form-group lb-row">
						<label class="col-md-6 control-label"
							localize="deleteAccount.removeRemote"></label>
						<div class="propertyValue col-md-6">
							<div id="removeRemote" class="propertyValue"></div>
							<div>
								<span class="lb-help-block form-text text-muted mt-2 mb-3 pl-1"
									localize="deleteAccount.removeRemote.info"></span>
							</div>
						</div>
					</div>
				</div>
				<!-- dialog buttons -->
				<div class="modal-footer">
					<button type="button" class="btn btn-primary">Delete
						Account</button>
				</div>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">
	function canDelete(principal) {
		return currentMenu.canDelete && !canDelete.readOnly && !principal.locallyDeleted;
	}
	
	legacyjQueryReadyFix(function() {
		$("#deleteDialog").localize();
		$('#deleteAccount').data('action', function(resource) {
			$('#deleteAccountInfo').html(getResource(resource.realmModule === 'local' ? 'deleteLocalAccount.info' : 'deleteAccount.info').format(he.escape(stripNull(resource.principalName))));
			$("#deleteDialog").off("shown.bs.modal").on("shown.bs.modal", function() {
				$("#deleteDialog .modal-footer button.btn").off("click").on("click", function(e) {
					var cb = function(data) {
						if (data.success) {
							showSuccess(data.message);
						} else {
							showError(data.message);
						}
					};					
					$("#deleteDialog").modal('hide');
					$('#mainContainer').startSpin(getResource("text.deleting").format(he.escape(stripNull(resource.name))));
					
					
					deleteJSON(apiUrl + "/" + ($('#removeRemote').data('widget').getValue() ? 'remoteUser' : 'user') + "/" + resource.id, null, function(data) {
						if (data.success) {
							$('#contentUsersPlaceholder').bootstrapTable('remove', {
			                    field: 'id',
			                    values: [resource.id]
			                });
							$('#contentUsersPlaceholder').bootstrapTable('refresh');
							checkBadges(false);
							showSuccess(data.message);
						} else {
							showError(data.message);
						}
						$('#mainContainer').stopSpin();
					}, function(xmlRequest) {
						showError(xmlRequest.statusText + '(' + xmlRequest.status + ')');
						$('#mainContainer').stopSpin();
					});
				});
			});
			$('#removeRemote').empty();
			$('#removeRemote').switchInput({});
			if(resource.realmModule === 'local')
				$('#removeRemoteContainer').hide();
			else
				$('#removeRemoteContainer').show();
			$("#deleteDialog").modal({
				"backdrop" : "static",
				"keyboard" : true,
				"show" : true
			});
		});
	});
</script>