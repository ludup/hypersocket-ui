<!-- 
	Replace any PasswordPolicy or PasswordPolicys with Capitalized name of your resources e.g. Application or Applications
	Replace any passwordPolicy or passwordPolicys with lower case name of your resources e.g. application or applications
 -->

<div id="contentPasswordPolicys">
	<div class="modal" id="addPasswordPolicyForm" tabindex="-1" role="dialog" dialog-for="contentPasswordPolicys">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header lb-modal-header-text-reverse">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
					<div class="propertyItem form-group lb-row">
						<label class="col-3 control-label" localize="passwordPolicy.name.label"></label>
						<div class="propertyValue col-9">
							<input type="text" class="form-control"
								 id="resourceName" maxlength="" name="resourceName" value="">
							<div>
								<span class="lb-help-block form-text text-muted mt-2 mb-3 pl-1" localize="passwordPolicy.name.info"></span>
							</div>
						</div>
					</div>
					
					<div id="passwordPolicyProperties"></div>
					<div id="tabRoles" class="dialogTab col-12"></div>
					<input type="hidden" id="resourceId" name="resourceId" value="" />
				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>

</div>

<script type="text/javascript">
	legacyjQueryReadyFix(function() {
				$('#contentPasswordPolicys').localize();
					
				$('#tabRoles').roles();

				$('#contentPasswordPolicys').ajaxResourcePage(
						{
							id : "PasswordPolicy",
							tableUrl : "passwordPolicys/table",
							title: getResource("passwordPolicys.label"),
							icon: 'fa-globe',
							resourceUrl : "passwordPolicys/passwordPolicy",
							fields : [ {
								name : "name"
							}, {
								name : "provider",
								formatter: function(value) {
									if(!value || value==='') {
										return getResource('text.custom');
									} else {
										return getResource('realm.' + value + '.label');
									}
								}
							}],
							resourceKey : "passwordPolicy",
							canCreate: currentMenu.canCreate,
							canUpdate: currentMenu.canUpdate,
							canDelete: currentMenu.canDelete,
							checkUpdate: function(row) {
								return (!row.system || row.allowEdit) && currentMenu.canUpdate;
							},
							validate : function() {

								if ($('#resourceName').val() == '') {
									showError("error.nameRequired");
									return false;
								}

								if(!$('#passwordPolicyProperties').validateProperties()) {
									showError("error.correctValidationErrors");
									return false;
								}
								
								return true;
							},
							clearDialog : function(create) {
								
								$('#resourceId').val('');
								$('#resourceName').val('');
								$('#resourceName').attr('disabled', false);
								
								$('#passwordPolicyProperties').clearProperties();
								if(create) {
									$('#passwordPolicyProperties').propertyPage({ 
										url : 'passwordPolicys/template/', 
										showButtons : false, 
										canUpdate : currentMenu.canUpdate, 
										useTemplates : true,
										propertyTabsLast: false,
										i18nNamespace: 'passwordPolicy',
										additionalTabs : [{
												id : "tabRoles",
												name : getResource("label.roles"),
												checkDisplay: function(resource) {
													return !resource || !resource.system;
												}
										}] 
									});
								}
								
								$('#tabRoles').widget().clear();
								if((create && currentMenu.canCreate) || (!create && currentMenu.canUpdate)) {
									$('#tabRoles').widget().enable();
								} else {
									$('#tabRoles').widget().disable();
								}
								
								$('.tabPropertiesTab').first().trigger('click');
							},
							createResource : function() {
								resource = new Object();
								resource.id = $('#resourceId').val();
								resource.name = $('#resourceName').val();
								
								$('#passwordPolicyProperties').saveProperties(true,
										function(items) {
											resource.properties = items;
								});
								
								resource.roles = $('#tabRoles').widget().getValue();
								
								return resource;
							},
							displayResource : function(resource, readOnly) {
								
								$('#resourceId').val(resource.id);
								$('#resourceName').val(resource.name);
								$('#resourceName').attr('disabled', resource.system);

								$('#passwordPolicyProperties').propertyPage(
										{ url : 'passwordPolicys/properties/' + resource.id, 
											showButtons : false, 
											canUpdate : currentMenu.canUpdate && !readOnly,
											propertyTabsLast: false,
											i18nNamespace: 'passwordPolicy',
											additionalTabs : [{
													id : "tabRoles",
													name : getResource("label.roles"),
													checkDisplay: function() {
														return !resource.system;
													}
											}]
								});
								
								$('#tabRoles').widget().setValue(resource.roles);
								
								if(readOnly) {
									$('#tabRoles').widget().disable();
								} 
							},
							complete : function() {
								loadComplete();
							}
						});

			});
</script>