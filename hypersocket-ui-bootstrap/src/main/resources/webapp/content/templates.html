
<div id="contentTemplates">
</div>
<div id="templateContent" class="panel panel-default" page-for="contentTemplates">
  <!-- Default panel contents -->
  <div class="panel-heading">
  	<h2><i class="fa fa-file-code-o"></i><span class="break" localize="template.editing"></span></h2>
  </div>
  <div class="panel-body">
  	<div id="subjectContent" class="propertyItem form-group">
		<label class="col-xs-3 control-label" localize="template.name.label"></label>
		<div class="propertyValue col-xs-9">
			<input type="text" class="form-control propertyInput"
				placeholder="" id="name" maxlength="" name="name" value="">
			<div>
				<span class="help-block" localize="template.nameinfo"></span>
			</div>
		</div>
	</div>
	<div id="subjectContent" class="propertyItem form-group">
		<label class="col-xs-3 control-label" localize="template.subject.label"></label>
		<div class="propertyValue col-xs-9">
			<input type="text" class="form-control propertyInput"
				placeholder="" id="subject" maxlength="" name="subject" value="">
			<div>
				<span class="help-block" localize="template.subject.info"></span>
			</div>
		</div>
	</div>
	<textarea name="template" id="editor">This is some text.</textarea>
  </div>
</div>
<script type="text/javascript">


	$(document).ready(function() {

		$('#templateContent').hide();
		$('#contentTemplates').localize();
		$('#templateContent').localize();
		
		if($('textarea#editor').tinymce()) {
			$('textarea#editor').tinymce().remove();	
		}
		
		tinymce.init({
		    selector: "textarea#editor",
			width:      '98%',
			height: '400px',
		    statusbar:  false,
		    menubar: true,
		    theme: "modern",
		    theme_advanced_resizing : true,
		    plugins: [
		        "advlist autolink lists link image charmap print preview hr anchor pagebreak",
		        "searchreplace wordcount visualblocks visualchars code fullscreen",
		        "insertdatetime media nonbreaking save table contextmenu directionality",
		        "emoticons template paste textcolor colorpicker textpattern"
		    ],
		    toolbar1: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",
		    toolbar2: "print preview media | forecolor backcolor emoticons",
		    image_advtab: true,
		    setup : function(ed) {
                ed.on('change', function(e) {
		    		$('#saveTemplate').attr('disabled', false);
                });
		    }
		});
		
		
		$('#templateType').selectButton({
			id: 'type',
			url: 'templates/types',
			nameIsResourceKey: true,
			value: 'template.email',
			changed: function(scheme) {
				
			}
		});

		$('#templateProperties').propertyPage({
			url : 'templates/properties',
			showButtons : false,
			useTemplates : true,
			canUpdate : currentMenu.canUpdate,
			additionalTabs : [ {
				id : "tabDetails",
				name : getResource("template.label")
			}]
		});
		
		$('#contentTemplates').ajaxResourcePage2(
				{
				title: getResource('templates.title'),
				icon: 'fa-file-code-o',
				tableUrl : "templates/table",
				resourceUrl : "templates/template",
				fields : [ { name: "name", isResourceKey: true }, { name: "type", isResourceKey: true}],
				resourceKey : 'template',
				canCreate: currentMenu.canCreate,
				canUpdate: currentMenu.canUpdate,
				canDelete: currentMenu.canDelete,
				validate : function() {
					if ($('#name').val() == '') {
						showError(true, getResource("error.nameRequired"));
						return false;
					}
					return true;
				},
				clearDialog : function() {
					$('#name').val('');
					$('#subject').val('');
					tinyMCE.activeEditor.setContent('');
				},
				createResource : function() {
					var resource = $('#templateContent').data('resource');
					resource.subject = $('#subject').val();
					resource.template = tinyMCE.activeEditor.getContent({format : 'raw'});
					return resource;
				},
				displayResource : function(resource) {
					$('#templateContent').data('resource', resource);
					if(resource.nameIsResourceKey) {
						$('#name').val(getResource("template." + resource.name + ".label"));
						$('#name').attr('disabled', true);
					} else {
						$('#name').val(resource.name);
						$('#name').attr('disabled', false);
					}
					tinyMCE.activeEditor.setContent(resource.template);
					if(resource.hasSubject) {
						$('#subjectContent').show();
						$('#subject').val(resource.subject);
					} else {	
						$('#subjectContent').hide();
						$('#subject').val('');
					}
				},
				complete: function() {
					loadComplete();
				}
			});
	});
	</script>