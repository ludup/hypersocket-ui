<div class="modal" id="pluginUpload" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header lb-modal-header-text-reverse">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title" localize="pluginUpload.label"></h4>
			</div>
			<div class="modal-body">
				<div class="propertyItem form-group lb-row">
					<p id="pluginUploadInfo"></p>
				</div>
				<div id="certDiv" class="propertyItem form-group lb-row">
					<label id="fileLabel" class="col-md-3 control-label"
						localize="pluginUpload.file.label"></label>
					<div class="propertyValue col-md-9">
						<input type="file" class="form-control"
							 id="uploadPluginFile" maxlength="" name="uploadPluginFile" value="">
						<div>
							<span class="lb-help-block form-text text-muted mt-2 mb-3 pl-1" localize="pluginUpload.file.info"></span>
						</div>
					</div>
				</div>
				<div id="startContainer" class="propertyItem form-group lb-row">
					<label class="col-md-3 control-label"
						localize="pluginUpload.start"></label>
					<div class="propertyValue col-md-8">
						<div id="start" class="propertyValue"></div>
						<div>
							<span class="lb-help-block form-text text-muted mt-2 mb-3 pl-1"
								localize="pluginUpload.start.info"></span>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button id="uploadButton" type="button" class="btn btn-primary"><i id="uploadIcon" class="far fa-upload"></i><span localize="text.upload"></span></button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">

	legacyjQueryReadyFix(function() {
		
		$('#pluginUpload').localize();
		$('#start').empty();
		$('#start').switchInput({});
		
		$('#pluginUpload').data('action', function(callback) {
			$('#pluginUpload').data('callback', callback);
			$('#pluginUpload').modal('show');
		});
		
		$('#uploadButton').click(function(e) {
			var fileEl = $('#uploadPluginFile')[0];
			var file = fileEl.files[0]; 
			if (!file) {
				showError(getResource("error.selectFile"));
				return;
			}
			$('#uploadIcon').removeClass('fa-upload');
			$('#uploadIcon').addClass('fa-spinner fa-spin');
			var formData = new FormData();
			formData.append('file', file);
			formData.append('start', $('#start').data('widget').getValue());
			
			doAjax({
				type : 'POST',
				url : basePath + '/api/plugins/upload',
				dataType : 'json',
				cache : false,
				contentType : false,
				mimeType: 'multipart/form-data',
				processData : false,
				data : formData,
				success : function(data) {

					if (data.success) {
						$('#pluginUpload').modal('hide');
						$('#pluginUpload').data('callback')(data.message);
					} else {
						showError(data.message);
					}

				},
				error: function(jqXHR, textStatus, errorThrown) {
					showError(errorThrown);
				},
				complete: function() {
					$('#uploadIcon').removeClass('fa-spinner fa-spin');
					$('#uploadIcon').addClass('fa-upload');
				}
			});
		});
		
	});
</script>