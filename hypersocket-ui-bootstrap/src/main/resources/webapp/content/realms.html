<div id="realmsContent" class="col-md-12" style="padding-left: 0px;">
</div>
	<script type="text/javascript">
	
		$(document).ready(function() {
			
			$('#realmsContent').load('${uiPath}/content/realmsDialog.html', function() {
				
				$('#realmsContent').localize();
			

				getJSON('menus/tableActions/realmActions', null, function(data) {
					
					var actions = new Array();
					
					if(data.resources.length > 0) {
						$.each(data.resources, function(idx, action) {
							var div = action.resourceKey + 'Div';
							$('#additionalActions').append('<div id="' + div + '"></div>');
							$('#' + div).load(uiPath + '/content/' + action.url + '.html');
							actions.push({
								resourceKey : action.resourceKey,
								iconClass : action.iconClass,
								action : function(resource, callback) {
									if($('#' + action.resourceKey).data('action')) {
										$('#' + action.resourceKey).data('action')(resource, callback);
									}
								},
								enabled : true,
								enableFunction: action.enableFunction,
								displayFunction: action.displayFunction
							});
						});
					 }

					$('#realmsContent')
						.ajaxResourcePage(
							{ id: 'Realm',
							  tableUrl : "realms/table", 
							  title : getResource('realms.title'),
							  icon : "fa-database",
							  resourceUrl : "realms/realm",
							  deleteResourcesUrl : "realms/bulk",
							  fields : [ { name : "name" },
							             { name : "resourceCategory",
								           formatter: function(value, obj, index) {
								        	   return getResource("realm." + obj.resourceCategory + ".label");
								           }}
							  ], 
							  resourceKey : 'realm', 
							  canCreate : currentMenu.canCreate, 
							  canUpdate : currentMenu.canUpdate, 
							  canDelete : currentMenu.canDelete,
							  additionalButtons : [{
							  		resourceKey: 'realmImport',
									buttonClass: 'btn-primary',
									icon: 'fa-upload',
									action: function(callback) {
										if(!$('#importRealmPlaceholder').length) {
											$('body').append('<div id="importRealmPlaceholder"></div>');
										}
										$('#importRealmPlaceholder').load(uiPath + "content/importRealmDialog.html", function(){
											$('#importRealm').data('importUrl', 'realms/import');
											$('#importRealm').data('action')(callback);
										});
									}
							  }],
							  additionalActions : actions,
							  checkbox : true,
							  validate : function() {
								  
								removeMessage();
								  
								if ($('#name').val() == '') {
									showError(getResource("text.nameRequired"));
									return false;
								}
								
								if(!$('#realmProperties').validateProperties()) {
									showError("error.correctValidationErrors");
									return false;
								}
								
								return true;
							}, clearDialog : function(create) {
								$('#name').val("");
								$('#name').attr('disabled', false);
								$('#id').val("");
								$('#realmProperties').clearProperties();
								removeMessage();
							}, createResource : function() {
								realm = new Object();
								realm.name = $('#name').val();
								realm.type = $('#typeButton').widget().getValue();
								realm.id = $('#id').val();

								$('#realmProperties').saveProperties(true,
									function(items) {
										realm.properties = items;
								});

								return realm;
							},confirmed: function(resource, args) {
								if('realm.knownHosts' in resource.properties) {
									var pr = resource.properties['realm.knownHosts'] ;
									if(pr.value.length > 0)
										pr.value += ']|[';
									pr.value += args[3];
								}
								else {						
									resource.properties.push(new PropertyItem('realm.knownHosts', args[3]));
								}
							}, checkDelete: function(resource) {
								return !resource.system;
							}, checkUpdate: function(resource) {
								return true;
							}, 
							checkReadOnly: false,
						    showCreate : function() {

								$('#typeButton').widget().enable();
								$('#typeButton').widget().selectFirst();

							}, displayResource : function(resource, readOnly) {

								$('#id').val(resource.id);
								$('#name').val(resource.name);
								$('#name').attr('disabled', resource.system || readOnly);
								if(resource.resourceCategory!=='local') {
									$('#realmsContent').data('local', false);
									$('#typeButton').widget().disable();
								} else {
									$('#realmsContent').data('local', true);
									$('#typeButton').widget().enable();
								}
								$('#typeButton').widget().setValue(resource.resourceCategory);
								$('#typeButton').data('original', resource.resourceCategory);
								$('#realmProperties').propertyPage(
									{ url : 'realms/realm/properties/' + resource.id, 
										showButtons : false, 
										resource: resource,
										i18nNamespace: $('#typeButton').widget().getSelectedObject().module,
										displayMode: 'admin,update,parent',
										canUpdate : currentMenu.canUpdate && !readOnly,
										
								});
							}, complete : function() {
								loadComplete();
							}, resourceCreated : function(resource) {
								reloadRealms();
								getJSON('menus/realms', null, function(data) {
									if(data.success) {
										if(data.resource.canCreate) {
											$('#realmsContentAdd').show();
										} else {
											$('#realmsContentAdd').hide();
										}
									}
								});
							}, resourceUpdated : function(resource) {
								if(resource.resourceCategory!=='local' && $('#realmsContent').data('local')) {
									window.location.hash = 'menu=realms';
									window.location.reload();
								} else {
									reloadRealms();
								}
							}, resourceDeleted : function(resource) {
								reloadRealms();
								getJSON('menus/realms', null, function(data) {
									if(data.success) {
										if(data.resource.canCreate) {
											$('#realmsContentAdd').show();
										} else {
											$('#realmsContentAdd').hide();
										}
									}
								});
							} });

						});
			});
			
			
		});
	</script>