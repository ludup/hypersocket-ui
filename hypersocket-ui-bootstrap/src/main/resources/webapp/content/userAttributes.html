<div id="attributeContent">
	<div class="modal" id="addResourceForm" tabindex="-1" role="dialog"
		dialog-for="attributeContent">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
					<form class="form" autocomplete="off">
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="attribute.name.label"></label>
							<div class="propertyValue col-md-9">
								<input type="text" id="attributeName" autocomplete="off" class="form-control" />
								<div>
									<span class="help-block" localize="attribute.name.info"></span>
								</div>
							</div>
						</div>
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="attribute.category.label"></label>
							<div class="propertyValue col-md-9">
								<div id="attributeCategoryAutocomplete"></div>
								<div>
									<span class="help-block" localize="attribute.category.info">&nbsp;</span>
								</div>
								
							</div>
						</div>
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label">&nbsp;</label>
							<div class="propertyValue col-md-9">
								<button id="createCategory" class="btn btn-primary">
									<i class="fa fa-plus-circle"></i>
									<span localize="attribute.createCategory">&nbsp;</span>
								</button>
								<div>
									<span class="help-block" localize="attribute.createCategory.info">&nbsp;</span>
								</div>
							</div>
						</div>
						
						
						<div id="attributePropertiesPanel" class="panel panel-default">
							<div class="panel-heading">
								<h2>
									<i class="fa fa-th"></i><span class="break"></span>
								</h2>
								<ul id="attributePropertiesTabs" class="nav nav-tabs" role="tablist">
									<li id="tabAttributeInfoLi" role="presentation" class="active">
										<a href="#tabAttributeInfo" role="tab" data-toggle="tab" aria-controls="tabAttributeInfo" class="attributePropertiesTab attributePropertiesTab2">
											<span localize="attribute.attribute.label"></span>
										</a>
									</li>
									<li id="tabOtherLi" role="presentation" >
										<a href="#tabOther" role="tab" data-toggle="tab" aria-controls="tabOther" class="attributePropertiesTab attributePropertiesTab2">
											<span localize="attributeCategory.attributeOptions.label"></span>
										</a>
									</li>
									<li id="tabRolesLi" role="presentation" >
										<a href="#tabRoles" role="tab" data-toggle="tab" aria-controls="tabRoles" class="attributePropertiesTab attributePropertiesTab2">
											<span localize="roles.title"></span>
										</a>
									</li>
								</ul>
							</div>
							<div class="panel-body">
								<div class="tab-content">
									<div id="tabAttributeInfo" role="tabpanel" class="tab-pane active">
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.type.label"></label>
											<div class="propertyValue col-md-9">
												<div id="attributeType" class="propertyValue"></div>
												<div>
													<span class="help-block" localize="attribute.type.info"></span>
												</div>
											</div>
										</div>
										
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.variableName.label"></label>
											<div class="propertyValue col-md-9">
												<input type="text" id="attributeVariableName" autocomplete="off" class="form-control" />
												<div>
													<span class="help-block" localize="attribute.variableName.info"></span>
												</div>
											</div>
										</div>
										
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.defaultValue.label"></label>
											<div class="propertyValue col-md-9">
												<input type="text" id="attributeDefaultValue" autocomplete="off" class="form-control" />
												<div>
													<span class="help-block" localize="attribute.defaultValue.info"></span>
												</div>
											</div>
										</div>
										
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.description.label"></label>
											<div class="propertyValue col-md-9">
												<textarea maxlength="1024" rows="4" cols="50" id="attributeDescription" class="form-control" />
												<div>
													<span class="help-block" localize="attribute.description.info"></span>
												</div>
											</div>
										</div>

										<input type="hidden" name="attributeId" id="attributeId">
									</div>
									<div id="tabOther" role="tabpanel" class="tab-pane">
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.displayMode.label"></label>
											<div class="propertyValue col-md-9">
												<div id="attributeDisplayMode"></div>
												<div>
													<span class="help-block" localize="attribute.displayMode.info"></span>
												</div>
											</div>
										</div>
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.readOnly.label"></label>
											<div class="propertyValue col-md-9">
												<div id="attributeReadOnly" class="propertyValue"></div>
												<div>
													<span class="help-block" localize="attribute.readOnly.info"></span>
												</div>
											</div>
										</div>
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.required.label"></label>
											<div class="propertyValue col-md-9">
												<div id="attributeRequired" class="propertyValue"></div>
												<div>
													<span class="help-block" localize="attribute.required.info"></span>
												</div>
											</div>
										</div>
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.encrypted.label"></label>
											<div class="propertyValue col-md-9">
												<div id="attributeEncrypted" class="propertyValue"></div>
												<div>
													<span class="help-block" localize="attribute.encrypted.info"></span>
												</div>
											</div>
										</div>
										<div class="propertyItem form-group">
											<label class="col-md-3 control-label" localize="attribute.weight.label"></label>
											<div class="propertyValue col-md-9">
												<input type="number" id="attributeWeight" autocomplete="off" class="form-control" />
												<div>
													<span class="help-block" localize="attribute.weight.info"></span>
												</div>
											</div>
										</div>
									</div>
									<div id="tabRoles" role="tabpanel" class="tab-pane">
										<div id="attributeRoles" class="col-xs-12"></div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>
	<div id="additionalActions"></div>
</div>
<script type="text/javascript">
$(document).ready(function() {
	
	

	$('#attributeContent').localize();
	$('#attributeCategoryContent').localize();
	
	function createAutocomplete(selectedValue){
		$('#attributeCategoryAutocomplete').autoComplete({
			url: 'userAttributeCategories/categories',
			nameIsResourceKey: false,
			selectedValue: selectedValue
		});
	}
	createAutocomplete();
	
	$('#attributeType').selectButton({
		id: 'attributeType',
		name: 'Password',
		value: 'PASSWORD',
		options: [{ id: 'PASSWORD', name: 'Password', value: 'PASSWORD' },
		          { id: 'TEXT', name: 'Text', value: 'TEXT'}],
		nameIsResourceKey: false
	});
	
	$('#attributeDisplayMode').selectButton({
		id: 'attributeDisplayMode',
		value: '',
		options: [{ id: '', name: 'scope.user', value: '' },
		          { id: 'admin', name: 'scope.admin', value: 'admin'}],
		nameIsResourceKey: true
	});
	

	$('#attributeRoles').roles();

	
	$('#attributeReadOnly').switchInput({
		value: false,
		onResourceKey: 'text.yes',
	    offResourceKey: 'text.no'
	});
	
	$('#attributeRequired').switchInput({
		value: false,
		onResourceKey: 'text.yes',
	    offResourceKey: 'text.no'
	});
	
	$('#attributeEncrypted').switchInput({
		value: false,
		onResourceKey: 'text.yes',
	    offResourceKey: 'text.no'
	});
	
	$('#createCategory').click(function(e){
		e.preventDefault();
		$('#attributeTabContent').data('categoryPage').showCreate(function(resource) {
			
			$('#attributeCategoryAutocomplete').widget().reload(resource.id);
		});
	});

	
	$('#attributeCategoryContext').selectButton({
		id: 'attributeCategoryContext',
		name: 'User',
		value: 'user',
		options: [{ id: 'user', name: 'User', value: 'user' }],
		nameIsResourceKey: false
	});
	
	$('#attributeContent').ajaxResourcePage(
			{
				id : "attribute",
				title : getResource('attribute.title'),
				icon : 'fa-list-lu',
				tableUrl : "userAttributes/table",
				resourceUrl : "userAttributes/userAttribute",
				fields : [
					{name : "name"}
					],
				resourceKey : "attribute",
				disableDecoration: true,
				canCreate : true,
				canDelete : true,
				canUpdate : true,
				readOnly: false,
				validate : function() {
						if ($('#attributeName').val() == '') {
							showError('attribute.nameRequired.error');
							return false;
						}
						if ($('#attributeCategoryAutocomplete').data('widget').getValue() == '') {
							showError('attribute.categoryRequired.error');
							return false;
						}
						if ($('#attributeDescription').val() == '') {
							showError('attribute.descriptionRequired.error');
							return false;
						}
						if ($('#attributeWeight').val() == '') {
							showError('attribute.weightRequired.error');
							return false;
						}
						if ($('#attributeType').data('widget').getValue() == '') {
							showError('attribute.typeRequired.error');
							return false;
						}
						if ($('#attributeVariableName').val() == '') {
							showError('attribute.variableNameRequired.error');
							return false;
						}
						
						if (!isNaN($('#attributeVariableName').val())) {
							showError('attribute.variableNameNumeric.error');
							return false;
						}
					return true;
				},
				clearDialog : function(create) {
					$('#attributeId').val('');
					$('#attributeName').val('');
					$('#attributeCategoryAutocomplete').data('widget').clear();
					$('#attributeDescription').val('');
					$('#attributeDefaultValue').val('');
					$('#attributeWeight').val('0');
					$('#attributeType').data('widget').reset();
					$('#attributeDisplayMode').data('widget').reset();
					$('#attributeReadOnly').data('widget').setValue(false);
					$('#attributeRequired').data('widget').setValue(false);
					$('#attributeEncrypted').data('widget').setValue(false);
					$('#attributeVariableName').val('');
					
					$('#attributeRoles').widget().clear();
					if((create && currentMenu.canCreate) || (!create && currentMenu.canUpdate)) {
						$('#attributeRoles').widget().enable();
					} else {
						$('#attributeRoles').widget().disable();
					}
					
					$('.tabPropertiesTab').first().trigger('click');
				},
				createResource : function() {
					resource = new Object();
					resource.id = $('#attributeId').val();
					resource.name = $('#attributeName').val();
					resource.category = $('#attributeCategoryAutocomplete').data('widget').getValue();
					resource.description = $('#attributeDescription').val();
					resource.defaultValue = $('#attributeDefaultValue').val();
					resource.weight = $('#attributeWeight').val();
					resource.type = $('#attributeType').data('widget').getValue();
					resource.displayMode = $('#attributeDisplayMode').data('widget').getValue();
					resource.readOnly = $('#attributeReadOnly').data('widget').getValue();
					resource.required = $('#attributeRequired').data('widget').getValue()
					resource.encrypted = $('#attributeEncrypted').data('widget').getValue();
					resource.variableName = $('#attributeVariableName').val();
					resource.roles = $('#attributeRoles').widget().getValue();
					
					return resource;
				},
				displayResource : function(resource, readOnly) {
					$('#attributeId').val(resource.id);
					$('#attributeName').val(resource.name);
					$('#attributeCategoryAutocomplete').data('widget').setValue(resource.category.id);
					$('#attributeDescription').val(resource.description);
					$('#attributeDefaultValue').val(resource.defaultValue);
					$('#attributeWeight').val(resource.weight);
					$('#attributeType').data('widget').setValue(resource.type);
					$('#attributeDisplayMode').data('widget').setValue(resource.displayMode);
					$('#attributeReadOnly').data('widget').setValue(resource.readOnly);
					$('#attributeRequired').data('widget').setValue(resource.required);
					$('#attributeEncrypted').data('widget').setValue(resource.encrypted);
					$('#attributeVariableName').val(resource.variableName);
					
					$('#attributeRoles').widget().setValue(resource.roles);
					
					if(readOnly) {
						$('#attributeRoles').widget().disable();
					} 
				},
				complete : function() {
					loadComplete();
				},
				resourceSaved: function() {
					loadResources();
				},
				resourceDeleted: function() {
					loadResources();
				}
	});
});
</script>
